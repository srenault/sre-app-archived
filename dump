#!/bin/bash

if [ -z "$1" ]
then
    echo "Please specify endpoint"
    exit 1;
fi

if [ -z "$2" ]
then
    echo "Please specify main account id"
    exit 1;
fi

ENDPOINT=$1
ACCOUNT_ID=$2

generate () {
    REQUEST=$1
    OUTPUT=$2

    echo -n "export default " > $OUTPUT
    curl -s $REQUEST | ./node_modules/json-to-js/index.js >> $OUTPUT
    echo -n ";" >> $OUTPUT
}

# FINANCE

FINANCE_ENDPOINT=$ENDPOINT"/finance"
FINANCE_OUTPUT_DIR="src/ApiClient/mock/dump/finance"

rm -f $FINANCE_OUTPUT_DIR/*

# FINANCE - BALANCES
if [ ! -d $FINANCE_OUTPUT_DIR ]; then
  mkdir -p $FINANCE_OUTPUT_DIR;
fi

ACCOUNTS_OUTPUT=$FINANCE_OUTPUT_DIR"/accounts.js"
generate $FINANCE_ENDPOINT"/accounts" $ACCOUNTS_OUTPUT

ACCOUNT_OUTPUT=$FINANCE_OUTPUT_DIR"/account.js"
generate $FINANCE_ENDPOINT"/accounts/"$ACCOUNT_ID $ACCOUNT_OUTPUT

ANALYTICS_OUTPUT=$FINANCE_OUTPUT_DIR"/analytics.js"
echo $FINANCE_ENDPOINT"/analytics"
generate $FINANCE_ENDPOINT"/analytics" $ANALYTICS_OUTPUT

# RELEASES

RELEASES_ENDPOINT=$ENDPOINT"/releases"
RELEASES_OUTPUT_DIR="src/ApiClient/mock/dump/releases"

RELEASES_OUTPUT=$RELEASES_OUTPUT_DIR"/index.js"
generate $RELEASES_ENDPOINT $RELEASES_OUTPUT
